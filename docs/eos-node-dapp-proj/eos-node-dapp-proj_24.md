# 七、.6 K 线图报表功能设计与实现

本小节我们将介绍如何实现对外 K 线图报表数据查询;当发生成交订单时，如何实时推送报表数据至前端展示页。

* * *

## 功能介绍

K 线图报表功能，主要用于按照用户所选择的不同维度 K 线图进行不同报表数据展示；当有新成交订单时按照推送最新 K 线数据至前端页面。

## 接口服务

### 查询报表数据

支持 5 分钟、30 分钟、小时、天四种维度的 K 线图数据展示

**触发条件：**

1.  当用户第一次进行交易所时，需要根据当前报表维度(分、时、天) 查询固定时间段报表数据
2.  当用户切换交易对时， 需要根据报表当前维度(分、时、天)查询固定时间段的报表数据
3.  当用户拖动 K 线图时，需要根据当前维度查询不同时间段的报表数据

**数据接口**

*   **请求参数:**

    ```js
    {
        "pairid": "", //交易对 id
        "begintime": "", //查询时间区间（开始）: 2019-02-01 09:00:00
        "endtime": "",   //查询时间区间（结束）: 2019-02-01 09:00:00
        "duration": ""   //查询周期: 60(1min)、3600(1Hour)、86400(1 天)
    }
    ```

*   **提交方式：**

    ```js
    `post`
    ```

*   **响应结果：**

    ```js
    {
      "result": "ok",
      "data": [
        ["2019-02-01 12:00", 0.021200, 0.021200, 0.030000, 0.020000, 120391], //time, close, open, high, low, volume. (时间，收盘价、开盘价、当日最高价、当日最低价、当日成交量)
        ... ...
      ]
    }
    ```

### 推送报表数据

支持 5 分钟、30 分钟、小时、天四种维度的 K 线图数据推送

**触发条件：**

*   当监测到有新成交记录时，需在同步完区块数据后，增量推送最新的报表数据至用户 web 端

**数据接口**

*   **接口地址(TOPIC)** `kline.query`
*   **请求参数**
    1.  交易对 id ：查询报表所对应的交易对
    2.  开始时间：报表展示开始时间
    3.  结束时间：报表展示结束时间
    4.  时间周期：报表展示维度
*   **响应结果：** 监听方法: kline.query

    ```js
    {
        "method": "kline.query",
        "data": [
            //time, close, open, high, low, volume. 
            //(时间，收盘价、开盘价、当日最高价、当日最低价、当日成交量)
            ["2019-02-01 12:00", 0.021200, 0.021200, 0.030000, 0.020000, 120391], 
                ... ...
        ],
        "params": [1, 3600] //交易对 id, 时间周期
    } 
    ```

    ## 技术实现

    1.  可根据前端请求的数据范围及展示维度，聚合后台报表数据。
    2.  在同步数据区块时，加入报表数据推荐的业务逻辑。

* * *

通过本小节的学习、思考与动手实践，我们完成了 K 线图的报表数据查询与推送功能。

* * *

> 在教程中如出现错误🐛或不易理解的知识点，欢迎加我微信指正! Name: zhangliang | WeChat: rushking2009 | Mail: zhangliang@cldy.org

![Show me your code.](img/9c507c40d372f5692d061c802a44deb2.jpg "加群了解")![](img/aab6c923225b0a35b6580de17534641d.jpg)

注： 有想了解**愿码全思维 IT 工程师加速器**的朋友，可以扫码加群咨询。

* * *

### **changelog**

2019-03-04 zhangliang

*   初次发稿

2019-03-05 zhangliang

*   完善 http/socket 数据接口及参数