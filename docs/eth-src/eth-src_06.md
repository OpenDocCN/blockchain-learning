# 第六章 交易池

交易池之所以存在，一方面为了通过队列的方式缓存交易，防止大量交易的拥堵堵塞；另一方面通过多个队列的方式来筛选不同交易数据，提高交易的处理效率。

在交易池内部实现逻辑中，存在两种类型队列:

*   pending 队列, 主要用于存储用户创建的准备就绪可执行的交易；
*   queue 队列，主要用于存储用户创建的暂不可执行的交易

另外，根据以太坊客户端的不同，TxPool 数据结构根据客户端的不同分为全客户端实现、轻客户端两种实现。
两者的区别在于: 轻客户端比全客户端少了 queue 队列，意味着轻客户端只会按照交易的创建顺序接收本地签名的交易。

## 小知识点

**1\. 为什么用户会存在暂不可执行交易呢？**
在以太坊平台中，用户的交易都是按其帐户 nonce 值进行顺序执行的，任何 nonce 过大的交易都只能等待前一个(过大 nonce 值-1)交易完成之后才会将交易从 queue 队列移至 pending 状态继续执行。

> 比如：用户 A 创建了 nonce 值为 1,2,3,4 的四笔交易，nonce 值为 4 的交易只能等 nonce 值为 1,2,3 的三笔交易顺序完成之后才可继续执行。

**2\. 创建了多条 nonce 值一样的交易会怎么样**
一般矿工会选择矿工费高的那条交易，而其他交易则会返回失败。

另外，需要补充的就是在交易加入交易池之前，会经过一系列参数校验，比如:nonce 值低于用户当前 nonce 值以及 gas 设置过低或超出交易池设定大小等，都会被返回失败处理。

> 🐛在教程中如出现任何看不明白或需要更正的问题，欢迎加我微信提见议！
> Name: zhangliang | WeChat: rushking2009 | Mail: zhangliang@cldy.org